app.service("dataServiceG2",["$http","$q","$location","$locale","config","$sce",function($http,$q,$location,$locale,config,$sce){var log=new Logger({name:"G2DataService"});var self=this;self.SUCCESS=1;self.ERROR=-1;self.quickPicks={};self.yardLocations=null;var locale=new LocaleService($locale,$sce,config);locale.refDataMessages=locale.getResource("RefDataTranslations");self.getLocale=function(){return locale};self.updateUserConfig=function(val,callBack){var deferred=$q.defer();var req={method:"POST",
url:"/public/data/userConfigUpdate",data:{"selectedLang":val.selectedLang,"selectedTimezone":val.selectedTimezone,"zipToCoordinate":val.zipToCoordinate},noCancelOnRouteChange:true};$http(req).then(function(response){deferred.resolve(response.data)},function errorCallback(response){deferred.reject("failed to update user config");log.error("failed to update user config"+response)});return deferred.promise};self.getSuggestion=function(val){var data=$.param({q:val});var deferred=$q.defer();var req={method:"POST",
url:"/public/data/lots/suggest",data:data,headers:{"Content-Type":"application/x-www-form-urlencoded; charset\x3dUTF-8"}};$http(req).then(function(response){deferred.resolve(response.data)},function errorCallback(response){deferred.reject("failed_to_get_suggestions_dataservice");log.error("Error for getSuggestion returned in dataservice"+response)});return deferred.promise};self.getQuickPicks=function(pageId,callBack){if(self.quickPicks[pageId])if(callBack)callBack(self.quickPicks[pageId]);else return;
$http.get("/public/data/quickPicks/"+pageId).then(function(response){self.quickPicks[pageId]=new QuickPicks(response.data.data.quickPicks,pageId);if(callBack)callBack(self.quickPicks[pageId])},function(response){if(callBack)callBack({});log.error("Error returned"+response)})};self.getQuickPickCounts=function(pageId,callback){$http.get("/public/data/quickPickCounts/"+pageId).then(function(response){self.totalItemsOnSale=response.data.data.totalItemsOnSale;if(callback)callback(response)},function(response){if(callback)callback({});
log.error("Error returned"+response)})};self.getdashBoardWatchList=function(callBack){$http.get("/data/lots/compactWatchList/").then(function(response){if(callBack)callBack(response)},function(response){if(callBack)callBack({});log.error("Error returned"+response)})};self.getUserConfig=function(){$http.get("/public/data/userConfig").then(function(response){},function(response){if(callBack)callBack({});log.error("Error returned"+response)})};self.addAllCheckedToWatchlist=function(lots,callBack){var data=
{lots:lots};$http.post("/data/lots/add/checked/watchlist",data).then(function(response){if(callBack)callBack(response)},function(response){if(callBack)callBack({});log.error("Error returned"+response)})};self.addAllToWatchlist=function(data,callBack){var req={method:"POST",url:"/data/lots/add/all/watchlist",data:data};$http(req).then(function(response){if(callBack)callBack(response)},function(response){log.error("Error returned"+response)})};self.removeCheckedFromWatchlist=function(lots,callBack){data=
{lots:lots};$http.post("/data/lots/remove/checked/watchlist",data).then(function(response){if(callBack)callBack(response)},function(response){if(callBack)callBack({});log.error("Error returned"+response)})};self.removeAllFromWatchlist=function(data,callBack){var req={method:"POST",url:"/data/lots/remove/all/watchlist",data:data};$http(req).then(function(response){if(callBack)callBack(response)},function(response){log.error("Error returned"+response)})};self.searchSavedSearches=function(callBack){$http({url:"/lot/savedSearches",
method:"GET"}).success(function(result,status,headers,config){if(result.returnCode==1){if(callBack)callBack(result)}else log.error("Error")}).error(function(result,status,headers,config){log.error("Error returned searchSavedSearches"+result+", status\x3d"+status)})};self.emailSavedSearch=function(search,callBack){var req={method:"POST",url:"/lot/emailSavedSearch/",data:search};$http(req).then(function(response){if(callBack)callBack(response)},function(response){log.error("Error returned in emailSavedSearch"+
response)})};self.deleteSavedSearch=function(id,callBack){$http.get("/lot/deleteSearch/"+id).success(function(response){if(callBack)callBack()}).error(function(response){log.error("Error returned"+response)})};self.saveSearch=function(data,callBack){var req={method:"POST",url:"/lot/saveCriteria",data:data};$http(req).then(function(response){if(callBack)callBack(response)},function(response){log.error("Error returned"+response)})};self.updateAuctionCount=function(callBack){var sortOrder={"sortColumn":1,
"sortOrder":"A"};$http.post("/public/data/todayAuctions",sortOrder).then(function(response){if(callBack)callBack(response)},function(response){if(callBack)callBack({});log.error("Error returned"+response)})};self.loadReferenceDataLess=function(callBack){jQuery.ajax({cache:false,url:"/public/data/referenceData/less",success:function(response){if(callBack)callBack(response)},async:false})};self.loadReferenceData=function(callBack){$http({url:"/public/data/referenceData",method:"GET",noCancelOnRouteChange:true}).then(function(response){if(callBack)callBack(response)})};
self.getEnvConfigProps=function(callBack){$http({url:"/public/data/envconfig/properties",method:"GET",noCancelOnRouteChange:true}).then(function(response){if(callBack)callBack(response.data.data)})};self.getLotDetails=function(lotNumber,callback){$http.get("/public/data/lotdetails/solr/"+lotNumber).then(function(response){if(callback)callback(response)})};self.getLotComparisionDetails=function(lotsToCompare,callback){$http.get("/public/data/compareLots/"+lotsToCompare).then(function(response){if(callback)callback(response)})};
self.getDynamicLotDetails=function(lotNumber,callback){$http.get("/public/data/lotdetails/dynamic/"+lotNumber).then(function(response){if(callback)callback(response)})};self.getConditionalReportForLot=function(lotNumber,callBack){$http.get("/public/data/lotdetails/solr/conditionalReport/"+lotNumber).then(function(response){if(callBack)callBack(response)})};self.getLotVideo=function(lotNumber,callBack){$http.get("/public/data/lotdetails/solr/lotVideo/"+lotNumber).then(function(response){if(callBack)callBack(response)})};
self.getLotByIndex=function(index,callback){$http.get("/public/data/lotdetails/index/"+index).then(function(response){response.index=index;if(callback)callback(response)})};self.getLotsByLotNumber=function(data,callBack){$http.post("/public/lots/number/search",data).then(function(response){if(callBack)callBack(response)},function(response){log.error("Error returned"+response)})};self.getOffisteYard=function(lotNumber,callback){$http.get("/public/data/lotdetails/offisteYard/"+lotNumber).then(function(response){if(callback)callback(response)})};
self.generateSaleDate=function(saleDateObj,callBack){$http.post("/public/data/lotdetails/generateSaleDate",saleDateObj).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.emailPassword=function(userIDOrEmail,callBack){$http.post("/public/data/emailPassword",userIDOrEmail).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getLotImages=function(lotNumber,
callback,data){var data=data||{};$http.post("/public/data/lotdetails/solr/lotImages/"+lotNumber,data).then(function(response){if(callback)callback(response)})};self.getDeliveryEstimate=function(requestParam,currentEstimatesList,callBack){var estimate={"newZipCode":requestParam.newZipCode,"lotNumber":requestParam.lotNumber,"requestType":requestParam.requestType,"orderScreen":requestParam.orderScreen,"module":requestParam.module};if(currentEstimatesList&&currentEstimatesList[requestParam.lotNumber]&&
!requestParam.newZipCode)if(callBack){var response={data:currentEstimatesList[requestParam.lotNumber],returnCode:1};callBack(response);return}$http.post("/public/data/delivery/estimate",estimate).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.changePassword=function(accountInfoVO,callBack){$http.post("/data/accountInfo/updatePassword",accountInfoVO).then(function(response){if(callBack)callBack(response)},function(response){console.log("Error updating password")})};
self.getCreditCardDetailsForDepositRefund=function(){var deferred=$q.defer();$http.post("/data/getCreditCardDetailsForDepositRefund").then(function(response){deferred.resolve(response)},function(response){console.log("Error getCreditCardDetailsForDepositRefund");deferred.reject(response)});return deferred.promise};self.getDepositRefundBalance=function(){var deferred=$q.defer();$http.post("/data/getDepositRefundBalance").then(function(response){deferred.resolve(response)},function(response){console.log("Error getDepositRefundBalance");
deferred.reject(response)});return deferred.promise};self.getDepositRefundTransactionHistory=function(cardID,callBack){var data={"cardID":cardID};$http.get("/data/getRefundHistory",{params:data}).then(function(response){if(callBack)callBack(response)},function(response){console.log("Error getDepositRefundTransactionHistory")})};self.submitDepositRefund=function(depositRefundDTO,callBack){$http.post("/data/submitDepositRefund",depositRefundDTO).then(function(response){if(callBack)callBack(response)},
function(response){console.log("Error submitDepositRefund")})};self.getLocationsList=function(continentCode,callBack){var data={"continentCode":continentCode};$http.get("/public/data/locations/retrieveLocationsList",{params:data}).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getRegions=function(callBack){$http.get("/public/data/regions").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+
response)})};self.getLocationDetail=function(yardNumber,callBack){var data={"yardNumber":yardNumber};$http.get("/public/data/locations/retrieveLocationDetail",{params:data}).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getNearestLocationDetail=function(data,callBack){var req={method:"POST",url:"/public/data/locations/nearest/zip",data:data};$http(req).then(function(response){if(callBack)callBack(response)},function(response){log.error("Error returned"+
response)})};self.getAccountInfoForms=function(callBack){$http.get("/data/myAccount/forms").then(function(response){if(callBack)callBack(response.data)},function(response){console.log("Error retrieving forms")})};self.getContactInfo=function(callBack){$http.get("/data/contactinfo").then(function(response){if(callBack)callBack(response.data)},function(response){console.log("Error retrieving Contact info")})};self.getMemberPreferences=function(callBack){$http.get("/data/getMemberPreference").then(function(response){if(callBack)callBack(response.data)},
function(response){console.log("Error retrieving Member Preferences")})};self.loadPaymentDueData=function(currency,callBack){$http({url:"/data/payments/loadInitialData/"+currency,method:"GET"}).success(function(data,status,headers,config){var data=data;if(callBack)callBack(data)}).error(function(data,status,headers,config){log.error("error to load loadReferenceData")})};self.loadPaymentDueMEAData=function(currency,callBack){$http({url:"/data/payments/loadInitialData/"+currency,method:"GET"}).success(function(data,
status,headers,config){var data=data;if(callBack)callBack(data)}).error(function(data,status,headers,config){log.error("error to load loadReferenceData")})};self.updateMemberPreference=function(accountPrefVO,callBack){$http.post("/data/updateMemberPreference",accountPrefVO).then(function(response){if(callBack)callBack(response)},function(response){console.log("Error updating Memeber Preferences")})};self.signUpForVehicleAlerts=function(vehicleAlertVO,callBack){$http.post("/public/data/vehicleAlertsSignUp",
vehicleAlertVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response);if(callBack)callBack(response)})};self.unsubscribeVehicleAlerts=function(subscriberKey,callBack){$http.post("/public/data/vehicleAlertsUnsubscribe",subscriberKey).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response);if(callBack)callBack(response)})};self.editVehicleAlerts=function(subscriberKey,
callBack){$http.post("/public/data/vehicleAlertsEdit",subscriberKey).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response);if(callBack)callBack(response)})};self.signUpToSellVehicleAsBusinessOrDealer=function(SellVehicleVO,callBack){$http.post("/public/registerAsBusiness",SellVehicleVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.signUpToSellVehicleAsIndividual=
function(SellVehicleVO,callBack){$http.post("/public/registerAsIndividual",SellVehicleVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getFinanceInfo=function(callBack){$http.get("/data/financeInfo/").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.verifyFinanceAccount=function(accountInfoVO,callBack){$http.post("/data/verifyFinance/",
accountInfoVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.confirmCounterBid=function(bidInquiryVO,callBack){$http.post("/data/lots/counterBid",bidInquiryVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getLicenseInfo=function(callBack){$http.get("/data/licenseInfo/").then(function(response){callBack(response.data)},function(response){failureCallBack("Error while retrieving data"+
response.data)})};self.uploadLicense=function(formData,callBack){var url="/data/uploadLicense";$http({url:url,method:"POST",data:formData,transformRequest:angular.identity,headers:{"Content-Type":undefined}}).success(function(data,status,headers,config){callBack(data)}).error(function(data,status,headers,config){alert("error while uploading license document")})};self.invoiceDetails=function(invoiceParam,callBack){$http({url:"/data/payments/invoiceDetails",method:"POST",data:{"paymentType":invoiceParam.paymentType,
"invoiceNumber":invoiceParam.invoiceId,"currencyCode":invoiceParam.selectedCurrency,"invoiceType":invoiceParam.invoiceType,"lotNumber":invoiceParam.lotNumber}}).success(function(data,status,headers,config){var data=data;if(callBack)callBack(data)}).error(function(data,status,headers,config){})};self.paySelectedInvoices=function(invoiceParam,callBack){console.log(invoiceParam);$http({url:"/data/payments/paySelectedInvoices/"+invoiceParam.paymentType+"/"+invoiceParam.invoiceIds+"/"+invoiceParam.invoiceTotal,
method:"POST"}).success(function(data,status,headers,config){var data=data;if(callBack)callBack(data)}).error(function(data,status,headers,config){})};self.paidInvoicesList=function(requesrParam,callBack){console.log(requesrParam);$http({url:"/data/payments/paidInvoicesList?transactionId\x3d"+requesrParam.transactionId,method:"GET"}).success(function(data,status,headers,config){var data=data;if(callBack)callBack(data)}).error(function(data,status,headers,config){})};self.setPciParam=function(requestParam,
callBack,url){if(requestParam.cookieValue==undefined)requestParam.cookieValue=$location.path();$http.post(url?url:"/data/payments/setPciParam/",requestParam).success(function(response){if(response.data.systemUp===false){$location.path("scheduleMaintainance");return}if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.paySelectedInvoicesMEA=function(requestParam,callBack,url){$http({data:requestParam,url:"/data/paymentsMEA/payInvoices",method:"POST"}).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("error to load paySelectedInvoices"+
response)})};self.callMEAPaymentSite=function(signedParams,callBack,url){$http({url:"https://testsecureacceptance.cybersource.com/pay?signature\x3d"+signedParams,method:"POST"}).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("error to load paySelectedInvoices"+response)})};self.emailInvoice=function(requesrParam,callBack){console.log(requesrParam);$http.post("/data/payments/emailInvoice",requesrParam).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+
response)})};self.registerNewMember=function(memberRegistrationVO,callBacks){$http({url:"/public/data/registration/registerNewMember",method:"POST",data:memberRegistrationVO}).success(function(data,status,headers,config){if(data.returnCode<0)callBacks.onFailure(data);else callBacks.onSuccess(data)}).error(function(data,status,headers,config){callBacks.onFailure(data)})};self.saveContactInfo=function(accountInfoVO,callBack){$http.post("/data/updatecontactinfo",accountInfoVO).then(function(response){if(callBack)callBack(response)},
function(response){console.log("Error updating contact information")})};self.createUpdateCountermanAccount=function(countermanVO,callBack){$http.post("/data/counterman/createUpdateAccount",countermanVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.deleteCountermanAccount=function(callBack){$http.get("/data/counterman/deleteAccount").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+
response)})};self.getCountermanAccount=function(callBack){$http.get("/data/counterman/getAccount").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.autoCheckPurchasedOrNot=function(callBack){$http.get("/public/data/lotDetails/checkForautoCheckGuide/").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getMarketGuideDetails=function(lotNumber,
callBack){$http.get("/public/data/lotDetails/getMarketguide/"+lotNumber).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.createMGuidePurchaseRequest=function(marketGuideInquiryVO,callBack){$http.post("/public/data/lotDetails/purchaseMarketguide/",marketGuideInquiryVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getVinDetails=function(vin,
callBack){$http.get("/public/data/lotDetails/getVinDetails/"+vin).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getNADAValues=function(lotNumber,callBack){$http.get("/public/data/lotDetails/getNadaValues/"+lotNumber).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getProquoteSalesList=function(lotNumber,callBack){$http.get("/public/data/lotDetails/getProquoteSalesList/"+
lotNumber).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getAutoCheckSubscriptionInfo=function(callBack){$http.get("/public/data/lotDetails/autoCheckInfo/").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.createAutoCheckKeyFile=function(autoCheckKeyVO,callBack){$http.post("/public/data/lotDetails/createAutoCheckKeyFile/",autoCheckKeyVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+
response)})};self.createAutoCheckSubscriptionRequest=function(autoCheckSubscrptionInquiryVO,callBack){$http.post("/public/data/lotDetails/createAutoCheckSubscriptionRequest/",autoCheckSubscrptionInquiryVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getPaymentSystem=function(paymentSystemInquiryDTO,callBack){$http.post("/public/data/payment/getPayment/",paymentSystemInquiryDTO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+
response)})};self.retrieveLotIconCodes=function(lotNumber,callBack){$http.get("/public/data/lotdetails/retrieveLotIconCodes/"+lotNumber).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.multilotbid=function(bidInquiryRequest,callBacks){$http({url:"/data/lots/prelim-bid",method:"POST",data:bidInquiryRequest}).success(function(data,status,headers,config){callBacks.onSuccess(data)}).error(function(data,status,headers,config){callBacks.onFailure(data)})};
self.updatedBidInfo=function(data,callBacks){$http({url:"/public/lots/bidDetails",method:"POST",data:data}).success(function(data,status,headers,config){callBacks.onSuccess(data)}).error(function(data,status,headers,config){callBacks.onFailure(data)})};self.getInspectors=function(facilityNumber,requestedPage,callBack){var data={"facilityNumber":facilityNumber,"requestedPage":requestedPage};$http.get("/public/data/inspectors/",{params:data}).then(function(response){if(callBack)callBack(response.data)},
function(response){console.log("Error retrieving Contact info")})};self.getInspectorDetails=function(inspectorNumber,callBack){var data={"inspectorNumber":inspectorNumber};$http.get("/public/data/inspectorDetails/",{params:data}).then(function(response){if(callBack)callBack(response.data)},function(response){console.log("Error retrieving Contact info")})};self.getBidderStatusList=function(callBack){$http.get("/data/bidders").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+
response)})};self.updateBidderStatus=function(bidderVO,callBack){$http.post("/data/bidders/status",bidderVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.updateBidderAllocatedLimit=function(bidderVO,callBack){$http.post("/data/bidders/bidlimit",bidderVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.changeBidderPassword=function(bidderVO,
callBack){$http.post("/data/bidders/password",bidderVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.resetBidderStatus=function(bidderVO,callBack){$http.post("/data/bidders/status/reset",bidderVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getBidderCounts=function(bidderVO,callBack){$http.post("/data/bidders/status/counts",bidderVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+
response)})};self.prelimBidForLot=function(bidInquiryVOArray,callBack,callBack1){$http.post("/data/lots/prelim-bid",bidInquiryVOArray).success(function(response){if(callBack)callBack(response,callBack1)}).error(function(response){log.error("Error returned"+response)})};self.getWatchListForBuyer=function(callBack){$http({method:"GET",url:"/data/lots/watchList",noCancelOnRouteChange:true}).then(function successCallback(response){if(callBack)callBack(response)},function errorCallback(response){log.error("Error is fetching WatchList"+
JSON.stringify(response))})};self.addToWatchList=function(lotNumber,callBack){$http({method:"GET",url:"/data/lots/addToWatchList/"+lotNumber}).then(function successCallback(response){if(callBack)callBack(response)},function errorCallback(response){log.error("Error: Failed to add lot in watch list")})};self.removeFromWatchList=function(lotNumber,callBack){$http({method:"GET",url:"/data/lots/removeFromWatchList/"+lotNumber}).then(function successCallback(response){if(callBack)callBack(response)},function errorCallback(response){log.error("Error: Failed to removed lot from watch list")})};
self.confirmBuyItNowPurchase=function(bidInquiryVO,callBack){$http.post("/data/submitBuyItNow",bidInquiryVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.searchCountermanInventory=function(countermanInventoryVO,callBack){$http.post("/data/searchCountermanInventory",countermanInventoryVO).then(function(response){if(callBack)callBack(response)},function(response){console.log("Error Searching Counterman Inventory")})};
self.getAllBrokers=function(requestedPage,callBack){var data={"requestedPage":requestedPage};$http.get("/public/data/allbrokers",{params:data}).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error while fetching All Brokers List"+response)})};self.getResellerServices=function(brokerNumber,callBack){$http.get("/public/data/resellerservices/"+brokerNumber).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error while fetching reseller services"+
response)})};self.getResellerPaymentMethods=function(brokerNumber,callBack){$http.get("/public/data/resellerpaymentmethods/"+brokerNumber).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error while fetching Reseller payment methods"+response)})};self.getMarketMakerslist=function(requestedPage,callBack){var data={"requestedPage":requestedPage};$http.get("/public/data/marketmakers",{params:data}).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error while fetching Market Makers List"+
response)})};self.getMarketMakerDetails=function(marketMaker,callBack){$http.get("/public/data/marketmakerdetails/"+marketMaker).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error while fetching Market maker details"+response)})};self.getResellerAccountInfo=function(brokerNumber,callBack){$http.get("/public/data/resellerinfo/"+brokerNumber).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error while fetching Reseller account info"+
response)})};self.getCldrData=function(language,locale,callBack){$http({method:"GET",url:"/public/data/cldrData/"+language+"/"+locale,noCancelOnRouteChange:true}).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.downloadLotImages=function(lotNumber,callBack){$http.get("/public/data/lotImages/download/"+lotNumber).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+
response)})};self.getBrokerPaymentBusinessInfo=function(callBack){$http.get("/data/brokerPaymentBusinessInfo").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getBrokerAccountInfo=function(callBack){$http.get("/data/brokerAccountProfile").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getBrokerServiceTexts=function(callBack){$http.get("/data/brokerServiceTexts").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+
response)})};self.getBrokerPaymentMethods=function(callBack){$http.get("/data/brokerPaymentMethods").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.updateBrokerInfo=function(brokerAdditionalInfoVO,callBack){$http.post("/data/brokerMoreInfo",brokerAdditionalInfoVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.towProviderContactUS=function(contactUsInquiry,
callBack){$http.post("/public/data/towproviderContactus",contactUsInquiry).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned in Tow providers contactus"+response)})};self.getDeliveryLocations=function(lotnumber,callBack){$http.get("/data/lot/transportation/deliveryLocations/"+lotnumber).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.updateQuote=function(){$http.post("/data/lot/transportation/addDeliveryLocation",
deliveryLocation).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.submitOrder=function(deliveryLocation,callBack){$http.post("/data/lot/transportation/submitOrder",deliveryLocation).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.validateAddress=function(deliveryLocation,callBack){$http.post("/data/lot/transportation/validateAddress",deliveryLocation).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+
response)})};self.cancelOrder=function(lotId,callBack){$http.get("/data/lot/transportation/cancelOrder/"+lotId).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.updateContactEmail=function(accountInfoVO,callBack){$http.post("/data/updateEmail",accountInfoVO).then(function(response){if(callBack)callBack(response)},function(response){console.log("Error updating contact information")})};self.updateBidderEmail=function(accountInfoVO,
callBack){$http.post("/data/bidders/updateEmail",accountInfoVO).then(function(response){if(callBack)callBack(response)},function(response){console.log("Error updating email information")})};self.updateBidderAccount=function(accountInfoVO,callBack){$http.post("/data/bidders/updateAccount",accountInfoVO).then(function(response){if(callBack)callBack(response)},function(response){console.log("Error updating account information")})};self.getSalesDataConfig=function(callBack){$http.get("/data/sales/config").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+
response)})};self.getCreditCardList=function(callBack){$http.get("/data/creditCardList").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.increaseBuyingPower=function(requestParam,callBack){$http.post("/data/bidLimitBatchNumber/",requestParam).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("upgradePremierAccount :: Error returned"+response)})};self.getAuctionsCalendarList=
function(callBack){var req={method:"GET",url:"/public/data/auctionsCalendarList",noCancelOnRouteChange:true,ignoreLoadingBar:true};$http(req).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.acceptTermsAndConditions=function(callBack){var data={};var req={method:"POST",url:"/data/terms/accept",data:data};$http(req).then(function(response){if(callBack)callBack(response)},function(response){log.error("Error returned"+response)})};
self.acceptEpayTerms=function(callBack){$http.get("/data/payments/acceptEpayTerms/").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getBidderPaymentCounts=function(callBack){$http.get("/data/payments/invoice/counts").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.checkYardBySiteCode=function(requestParam,callBack){$http({url:"/data/payments/checkYardBySiteCode/"+
requestParam.yardNumber,method:"POST"}).success(function(data,status,headers,config){var data=data;if(callBack)callBack(data)}).error(function(data,status,headers,config){log.error("Error returned"+response)})};self.getHireabrokerList=function(lotNumber,yardState,yardCountry,callBack){$http.get("/data/hireABroker/"+lotNumber+"/"+yardState+"/"+yardCountry).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getSpecificBrokerInfo=
function(brokerID,callBack){$http.get("/data/getSpecificBrokerInfo/"+brokerID).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.submitMakeAnOffer=function(bidInquiry,callBack){$http.post("/data/lots/makeAnOffer",bidInquiry).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getCurrentBidDetails=function(currentBidInquiry,callBack){$http.post("/data/currentBidDetails",
currentBidInquiry).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("getCurrentBidDetails Error returned"+response)})};self.postFeedback=function(data,callBack){$http.post("/public/data/feedback",data).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("postFeedback Error returned"+response)})};self.getAvailableBalance=function(accountInfoInquiry,callBack){$http.post("/data/availableBalance/",accountInfoInquiry).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("getAvailableBalance/My Account/Financing Error returned"+
response)})};self.getTodayAuctionData=function(url,callBack){$http.get(url).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.saleReceipt=function(saleReceiptParam,callBack){console.log(saleReceiptParam);$http({url:"data/payments/saleReceipt",method:"POST",data:{"invoiceNumber":saleReceiptParam.invoiceId}}).success(function(data,status,headers,config){var data=data;if(callBack)callBack(data)}).error(function(data,status,
headers,config){log.error("Error returned in sale Receipt"+response)})};self.getAdditionalLotNotes=function(lotNumber,callBack){$http.get("public/data/lot/additionalLotNotes/"+lotNumber).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.downloadCSV=function(url,criteria,successCallBack,failureCallBack){$http.post(url,criteria).then(function(response){if(successCallBack)successCallBack(response)},function(response){if(failureCallBack)failureCallBack({});
log.error("Error returned"+response)})}}]);
app.service("HttpPendingRequestsService",["$q","cfpLoadingBar",function($q,cfpLoadingBar){var cancelPromises=[];function newTimeout(){cfpLoadingBar.start();var cancelPromise=$q.defer();cancelPromises.push(cancelPromise);return cancelPromise.promise}function cancelAll(){cfpLoadingBar.complete();angular.forEach(cancelPromises,function(cancelPromise){cancelPromise.promise.isGloballyCancelled=true;cancelPromise.resolve()});cancelPromises.length=0}return{newTimeout:newTimeout,cancelAll:cancelAll}}]);
app.factory("HttpRequestTimeoutInterceptor",["$q","HttpPendingRequestsService",function($q,HttpPendingRequestsService){return{request:function(config){config=config||{};if(config.timeout===undefined&&!config.noCancelOnRouteChange)config.timeout=HttpPendingRequestsService.newTimeout();return config},responseError:function(response){if(response.config.timeout.isGloballyCancelled)return $q.defer().promise;return $q.reject(response)}}}]);
app.service("metaDataService",["$rootScope",function($rootScope){var self=this;var defaultTitleKey="app.home.title";var defaultDescKey="app.home.description";var metaArgs={};var currentRoute={};self.getTitleForRoute=function(route,locale){currentRoute=route;var ret="";try{if(route.titleKey)ret=locale.getMessageForKey(route.titleKey,getArgsValFromMetaArgs(route.arguments?route.arguments:route.titleArguments),locale.titleDescription);else ret=locale.getMessageForKey(defaultTitleKey)}catch(e){ret=locale.getMessageForKey(defaultTitleKey)}return ret};
self.getDescForRoute=function(route,locale){currentRoute=route;var ret="";try{if(route.descKey)ret=locale.getMessageForKey(route.descKey,getArgsValFromMetaArgs(route.arguments?route.arguments:route.descArguments),locale.titleDescription);else ret=locale.getMessageForKey(defaultDescKey)}catch(e){ret=locale.getMessageForKey(defaultDescKey)}return ret};self.refresh=function(locale){$rootScope.title=self.getTitleForRoute(currentRoute,locale);$rootScope.description=self.getDescForRoute(currentRoute,locale)};
self.setPreviousPage=function(url){$rootScope.previousPage=url};self.setNextPage=function(url){$rootScope.nextPage=url};self.clearPageTags=function(){$rootScope.previousPage=null;$rootScope.nextPage=null};var metaDataUpdateEvent=$rootScope.$on("meta-args-update",function(event,data){var keys=_.keys(data);for(var i=0;i<keys.length;i++)metaArgs[keys[i]]=data[keys[i]];$rootScope.$emit("update-site-meta")});var getArgsValFromMetaArgs=function(args){var ret=[];if(args){for(var i=0;i<args.length;i++)ret.push(metaArgs[args[i]]);
return ret}else return ret}}]);
app.service("geocodingService",["userService","dataServiceG2",function(userService,dataServiceG2){var self=this;self.zipToCoord={};self.getCoordinatesForZip=function(zip,callback){if(_.isEmpty(self.zipToCoord))self.zipToCoord=userService.userConfig.zipToCoordinate||{};var retData={latitude:0,longitude:0};if(!_.isEmpty(self.zipToCoord[zip])){retData.latitude=self.zipToCoord[zip].latitude;retData.longitude=self.zipToCoord[zip].longitude;if(callback)callback(retData)}else getCoordinatesFromGoogle(zip,retData,
callback)};var getCoordinatesFromGoogle=function(zip,retData,callback){var address=zip.trim();$.get("https://maps.googleapis.com/maps/api/geocode/json?address\x3d"+address).done(function(response){if(_.isEmpty(response.results)){retData.status=-1;return}if(!_.isEmpty(response.results[0].geometry.location)){retData.latitude=response.results[0].geometry.location.lat;retData.longitude=response.results[0].geometry.location.lng;self.zipToCoord[zip]={latitude:retData.latitude,longitude:retData.longitude};
var zipToCoordinate={};zipToCoordinate[zip]=retData;dataServiceG2.updateUserConfig({"zipToCoordinate":zipToCoordinate})}}).fail(function(){console.log.error("Failed to fetch Geocode.")}).always(function(){if(callback)callback(retData)})}}]);"use strict";
app.service("userService",["copartUser",function(copartUser){var self=this;self.userConfig=copartUser.config;self.bidIncrements=[];var pagesWithPreBid=["saleListResult","watchList","saleListResultAll"];var pagesWithShowAll=["saleListResult"];self.isAnonymous=function(){if(_.contains(self.userConfig.roles,"ROLE_ANONYMOUS"))return true;else return false};self.isPremium=function(){if(_.contains(self.userConfig.roles,"ROLE_PREMIUM"))return true;else return false};self.isInActive=function(){if(self.userConfig.buyerStatus==
"I")return true;else return false};self.isBroker=function(){if(_.contains(self.userConfig.roles,"ROLE_BROKER"))return true;else return false};self.isMaster=function(){if(_.contains(self.userConfig.roles,"ROLE_MASTER"))return true;else return false};self.isEligibleToMultiBid=function(url){for(var i=0;i<pagesWithPreBid.length;i++){var item=pagesWithPreBid[i];if(url.indexOf(item)!=-1)return copartUser.hasAccessPrivilege("MULTI_LOT_BIDDING")}return false};self.isShowAllEnabled=function(url){for(var i=
0;i<pagesWithShowAll.length;i++){var item=pagesWithShowAll[i];if(url.indexOf(item)!=-1)return true}return false};self.getBuyerNumber=function(){if(!_.isUndefined(self.userConfig.buyerNumber))return self.userConfig.buyerNumber;else return"1"}}]);
app.service("googleAdService",function(){var self=this;self.getGoogleAdObject=function(adPageName,adNumber,userService){var googleAdPrefMap=userService.userConfig.displayPref[adPageName];if(!adNumber||!googleAdPrefMap)return;return googleAdPrefMap[adNumber]?googleAdPrefMap[adNumber]:null}});
app.service("bidService",["copartUser","appConfigService","$locale",function(copartUser,appConfigService,$locale){var self=this;self.bidIncrements=[];self.locale=null;self.setLocale=function(locale){self.locale=locale};self.getBidIncrements=function(){var appConfig=appConfigService.getAppConfig();if(self.bidIncrements.length==0){self.bidIncrements=_.where(appConfig.bidIncrements,{bidType:"P"});return self.bidIncrements}else return self.bidIncrements};self.getBidIncrement=function(price){if(self.bidIncrements.length==
0)return 0;else{var prices=_.pluck(self.bidIncrements,"highPrice");for(var i in prices)if(parseInt(price)<parseInt(prices[i]))return parseInt(self.bidIncrements[i].bidInc);return parseInt(self.bidIncrements[self.bidIncrements.length-1].bidInc)}};self.checkBidValue=function(price,bidIncrement,currentBid){price=parseInt(price);var bidInc=bidIncrement;var bidErrorMsg="";if(price%bidInc!=0){var lowerBound=self.decrementValue(price,bidInc,currentBid);var upperBound=self.incrementValue(price,bidInc,currentBid);
bidErrorMsg=self.locale.getMessage("lotdetail.error.bid.notIn.increments",lowerBound,upperBound);return bidErrorMsg}else return bidErrorMsg};self.incrementValue=function(bidValue,incrementValue,currentBid){bidValue=parseInt(bidValue);incrementValue=parseInt(incrementValue);currentBid=parseInt(currentBid);var baseValue=currentBid+incrementValue;if((bidValue+incrementValue)%incrementValue==0)return bidValue+incrementValue<=9999999?bidValue+incrementValue<baseValue?baseValue:bidValue+incrementValue:
9999999;var incrementFactor=Math.abs(incrementValue-bidValue%incrementValue);return bidValue+incrementFactor<=9999999?bidValue+incrementFactor<baseValue?baseValue:bidValue+incrementFactor:9999999};self.decrementValue=function(bidValue,decrementValue,currentBid){bidValue=parseInt(bidValue);decrementValue=parseInt(decrementValue);currentBid=parseInt(currentBid);var baseValue=currentBid+decrementValue;if((bidValue-decrementValue)%decrementValue==0)return bidValue-decrementValue>baseValue?bidValue-decrementValue:
baseValue;var decrementFactor=Math.abs(decrementValue-bidValue%decrementValue);return bidValue-decrementValue+decrementFactor>baseValue?bidValue-decrementValue+decrementFactor:baseValue}}]);app.factory("watchListCache",["$cacheFactory",function($cacheFactory){return $cacheFactory("watchlist-cache")}]);
app.service("watchListService",["userService","appConfigService","$http","dataServiceG2","functionQueueService","siteCatalyst",function(userService,appConfigService,$http,dataServiceG2,functionQueueService,siteCatalyst){var self=this;var watchList=[];var isWatchList=false;var log=new Logger({name:"watchListService"});self.setWatchListDefinition=function(url){if(url.indexOf("/watchList")!=-1)isWatchList=true;else isWatchList=false;if(!userService.isAnonymous())self.getWatchListForBuyer()};self.isWatchList=
function(){return isWatchList};var refreshWatchListData=function(callBack){dataServiceG2.getWatchListForBuyer(function(response){if(_.isUndefined(watchList))watchList=response.data.data.watchList;else watchList=_.union(watchList,response.data.data.watchList);if(callBack)callBack(response)})};var forceRefreshWatchListData=function(){dataServiceG2.getWatchListForBuyer(function(response){watchList=response.data.data.watchList})};self.getWatchListForBuyer=function(){if(_.isUndefined(watchList)||watchList.length==
0)dataServiceG2.getWatchListForBuyer(function(response){if(_.isUndefined(watchList))watchList=response.data.data.watchList;else watchList=_.union(watchList,response.data.data.watchList)})};self.isAlreadyAdded=function(lotNumber){var object=_.find(watchList,function(item){return item.lotId==lotNumber});if(object)return true;else return false};self.addToWatchList=function(lotNumber,callBack){if(!userService.isAnonymous()){dataServiceG2.addToWatchList(lotNumber,function(response){if(response.data.returnCode==
1){var item={};item.lotId=lotNumber;watchList.push(item);if(callBack)callBack(response)}else if(response.data.data&&response.data.data.code&&response.data.data.message){alert(response.data.data.message);log.error("Failed to add lot in watch list--"+response.data.data.code)}});var siteCatalystVal={};siteCatalystVal.fname="doTagWatchList";siteCatalystVal.addremove="add";siteCatalystVal.lotId=lotNumber;siteCatalyst.addToQueue("doTagWatchList",siteCatalystVal);siteCatalyst.executeCall("doTagWatchList")}else functionQueueService.addToQueue({funcRef:self.addtoWatchlistAssumingLoggedInUser,
paramArr:[lotNumber]})};self.addtoWatchlistAssumingLoggedInUser=function(lotNumber){dataServiceG2.addToWatchList(lotNumber,function(response){if(response.data.returnCode==1){var item={};item.lotId=lotNumber;watchList.push(item)}else log.error("Failed to add lot in watch list")})};self.removeFromWatchList=function(lotNumber,callBack){if(!userService.isAnonymous()){dataServiceG2.removeFromWatchList(lotNumber,function(response){if(response.data.returnCode==1){var index=_.findIndex(watchList,function(lot){return lot.lotId==
lotNumber});if(index!=-1)watchList.splice(index,1);if(callBack)callBack(response)}else log.error("Failed to removed lot from watch list")});var siteCatalystVal={};siteCatalystVal.fname="doTagWatchList";siteCatalystVal.addremove="remove";siteCatalystVal.lotId=lotNumber;siteCatalyst.addToQueue("doTagWatchList",siteCatalystVal);siteCatalyst.executeCall("doTagWatchList")}};self.addAllCheckedToWatchList=function(selectedLots,callBack,errorCallBack){dataServiceG2.addAllCheckedToWatchlist(_.pluck(selectedLots,
"lotId"),function(response){if(response.data.returnCode!=-1){watchList=_.union(watchList,selectedLots);if(callBack)callBack(response)}else errorCallBack(response)})};self.addAllToWatchList=function(data,callBack,errorCallBack,syncCallBack){dataServiceG2.addAllToWatchlist(data,function(response){if(response.data.returnCode!=-1){refreshWatchListData(syncCallBack);if(callBack)callBack(response)}else errorCallBack(response)})};self.removeAllFromWatchlist=function(data,callBack){dataServiceG2.removeAllFromWatchlist(data,
function(response){if(response.data.returnCode!=-1)forceRefreshWatchListData();if(callBack)callBack(response)})};self.removeCheckedFromWatchlist=function(selectedLots,callBack){dataServiceG2.removeCheckedFromWatchlist(_.pluck(selectedLots,"lotId"),function(response){if(response.data.returnCode!=-1){watchList=_.filter(watchList,function(item){return _.isUndefined(_.findWhere(selectedLots,{lotId:item.lotId.toString()}))});if(callBack)callBack(response)}});for(var i in selectedLots)if(!AppUtils.isUndefined(selectedLots)&&
!AppUtils.isUndefined(selectedLots[i].lotId)){var siteCatalystVal={};siteCatalystVal.fname="doTagWatchList";siteCatalystVal.addremove="remove";siteCatalystVal.lotId=selectedLots[i].lotId;siteCatalyst.addToQueue("doTagWatchList",siteCatalystVal);siteCatalyst.executeCall("doTagWatchList")}};window.getWatchListLots=function(){return watchList}}]);
app.service("auctionsCalendarService",["dataServiceG2","$q","$interval","copartUser",function(dataServiceG2,$q,$interval,copartUser){var self=this;self.todaysAuctionDate=moment();self.getAuctionsCalender=function(refresh){var deferred=$q.defer();if(!_.isUndefined(self.allList)&&!refresh){deferred.resolve();return deferred.promise}dataServiceG2.getAuctionsCalendarList(function(response){self.todayAuctions={liveAuctions:[],endedAuctions:[],laterAuctions:[]};self.futureAuctions=[];if(response.returnCode==
1&&response.returnCodeDesc=="Success"){self.todaysAuctionDate=moment.utc(response.data.todaysAuctionDate);self.offset=copartUser.getUserTimzoneOffset();self.todayDate=self.todaysAuctionDate.utcOffset(self.offset).format("YYYYMMDD");if(moment.utc(response.data.todaysAuctionDate).startOf("isoWeek").toDate().getDay()==0)self.startDayofWeek=moment.utc(response.data.todaysAuctionDate).startOf("isoWeek").utcOffset(self.offset).add(1,"days");else self.startDayofWeek=moment.utc(response.data.todaysAuctionDate).startOf("isoWeek").utcOffset(self.offset);
self.allList=response.data.saleList;self.reGroupAuctions();deferred.resolve()}else deferred.reject()});return deferred.promise};self.reGroupAuctions=function(){_.each(self.allList,function(auction){if(auction.auctionDate!=null)if(auction.auctionDate.dateAsInt==self.todayDate)if(auction.isLive)self.todayAuctions.liveAuctions.push(auction);else if(auction.closedFlag=="Y")self.todayAuctions.endedAuctions.push(auction);else{if(auction.closedFlag=="N"||auction.closedFlag==""||auction.closedFlag=="E")self.todayAuctions.laterAuctions.push(auction)}else if(auction.auctionDate.dateAsInt>
self.todayDate)self.futureAuctions.push(auction)})};function refereshAuctionCalendar(){self.getAuctionsCalender(true)}$interval(refereshAuctionCalendar,18E4);self.getAllList=function(){var deferred=$q.defer();self.getAuctionsCalender(false).then(function(){deferred.resolve()});return deferred.promise};self.getAllAuctionData=function(){var deferred=$q.defer();self.getAuctionsCalender(false).then(function(){var data={};data.allList=self.allList;data.todayAuctions=self.todayAuctions;deferred.resolve(data)});
return deferred.promise};self.todayAuctionsByYard=function(yardNumber){var deferred=$q.defer();self.getAllList().then(function(){var auction=_.filter(self.allList,function(list){return list.yard.number==yardNumber&&list.auctionDate.dateAsInt==self.todayDate});deferred.resolve(auction)});return deferred.promise};self.laterAuctionsByYard=function(yardNumber){var deferred=$q.defer();self.getAllList().then(function(){var auction=_.filter(self.allList,function(list){return list.yard.number==yardNumber&&
list.auctionDate.dateAsInt>self.todayDate});deferred.resolve(auction)});return deferred.promise};self.auctionByYard=function(yardNumber){var deferred=$q.defer();self.getAllList().then(function(){var futureYardList=_.filter(self.allList,function(auction){var UnixAuctionDate=new Date(auction.auctionDate.date);var month=UnixAuctionDate.getMonth()+1>9?UnixAuctionDate.getMonth()+1:"0"+UnixAuctionDate.getMonth()+1;var date=UnixAuctionDate.getDate()>9?UnixAuctionDate.getDate():"0"+UnixAuctionDate.getDate();
var yardAuctionDate=""+UnixAuctionDate.getFullYear()+month+date;return Number(yardAuctionDate)>=Number(self.todayDate)});var auction=_.find(_.sortBy(futureYardList,function(auctionYard){return auctionYard.auctionDate.dateAsInt}),function(item){return item.closedFlag!="Y"&&item.yard.number==yardNumber});deferred.resolve(auction)});return deferred.promise};self.timeToAuction=function(auctionDate){if(!auctionDate)return null;var now=Date.now();var diff=(auctionDate-now)/1E3;if(diff<0)return null;var mins=
Math.floor(diff/60%60);var hours=Math.floor(diff/60/60%24);var days=Math.floor(diff/60/60/24);return days+"D "+hours+"H "+mins+"min"};self.getLanesListForLiveYard=function(yardNumber){var deferred=$q.defer();self.getAllList().then(function(){var laneInfoList={};if(self.todayAuctions.liveAuctions.length>0)_.each(self.todayAuctions.liveAuctions,function(list){if(list.yard.number==yardNumber)laneInfoList=list.laneInfoList});deferred.resolve(laneInfoList)});return deferred.promise};self.isYardLive=function(yardNumber){var deferred=
$q.defer();self.getAllList().then(function(){var flag=false;if(self.todayAuctions.liveAuctions.length>0)_.each(self.todayAuctions.liveAuctions,function(auction){if(auction.yard.number==yardNumber)flag=true});deferred.resolve(flag)});return deferred.promise};self.isAuctionLive=function(yardNumber,lane,auctionDate){var deferred=$q.defer();var flag=false;self.getAllList().then(function(){if(self.todayAuctions.liveAuctions.length>0)_.find(self.todayAuctions.liveAuctions,function(auction){if(auction.yard.number==
yardNumber&&moment.utc(auctionDate).isSame(moment.utc(auction.currentSaleTimeEpoch),"day")){_.find(auction.laneInfoList,function(laneInfo){if(laneInfo.lane==lane&&laneInfo.closedFlag=="I"){flag=true;return flag}});return flag}});deferred.resolve(flag)});return deferred.promise};self.getLotAuctionStatus=function(solrLots){var deferred=$q.defer();self.getAllList().then(function(){var data={"returnCode":2,"returnCodeDesc":"Success","data":{}};var lots={};_.each(solrLots,function(solrLot){var flag=false;
var lot={};lot.lotNum=solrLot.ln;if(self.todayAuctions.liveAuctions.length>0){var liveAuctionForYard=_.find(self.todayAuctions.liveAuctions,function(auction){if(solrLot.adt!="E"&&auction.yard.number==solrLot.ynumb&&moment.utc(solrLot.ad).isSame(moment.utc(auction.currentSaleTimeEpoch),"day")){flag=true;return auction}});lot.liveBid=flag==true?"Y":"N"}else lot.liveBid="N";lots[solrLot.ln]=lot});data.data=lots;deferred.resolve(data)});return deferred.promise}}]);
app.service("auctionsCalendarStoreService",["$q","$interval",function(dataServiceG2,$q,$interval){var self=this;var allList=[];self.auctionByYard=function(yardNumber){var deferred=$q.defer();self.getAllList().then(function(){var auction=_.find(allList,function(item){return item.yard.number==yardNumber});deferred.resolve(auction)});return deferred.promise};self.setAllList=function(list){allList=list}}]);
app.service("cmsContentService",["$http","$q","userService",function($http,$q,userService){var self=this;var cmsContentMap={};var selectedLanguage=userService.userConfig.selectedLang;self.getFragmentContent=function(parentFragmentId){return cmsContentMap[parentFragmentId]};self.setParentFragment=function(parentFragment){var deferred=$q.defer();if(_.isUndefined(cmsContentMap[parentFragment])){var req={method:"GET",url:self.getContentUrl(parentFragment)};$http(req).then(function(response){cmsContentMap[parentFragment]=
response.data;deferred.resolve(true)},function errorCallback(response){deferred.reject(false)})}else deferred.resolve(true);return deferred.promise};self.getContentUrl=function(fragmentId){if(fragmentId&&fragmentId.toLowerCase().indexOf("content")>-1){var splitArray=fragmentId.split("/");if(splitArray.length>3){var lang=appInit.localeString;var regionCode=appInit.regionCode;splitArray[1]=regionCode;splitArray[2]=lang;splitArray.splice(0,0,lang);splitArray.splice(0,0,"CMS");fragmentId=splitArray.join("/");
return checkAndAppendSlash(fragmentId)}else return checkAndAppendSlash(fragmentId)}else return checkAndAppendSlash(fragmentId)};function checkAndAppendSlash(fragmentId){if(fragmentId.indexOf("/")!=0)fragmentId="/"+fragmentId;return fragmentId}}]);"use strict";
app.service("accountInfoDataService",["$q","dataServiceG2","$window",function($q,dataServiceG2,$window){var self=this;var creditCards={};var refundBalance=null;var showHideDepositBalance="UnInitialized";self.getDepositRefundDetails=function(){var deferred=$q.defer();if(showHideDepositBalance==="UnInitialized")dataServiceG2.getCreditCardDetailsForDepositRefund().then(function(response){var successCode=response.data.returnCodeDesc;if(successCode==="Success"){creditCards=response.data.data.depositRefundCardDetails;
self.getDepositRefundBalance().then(function(showHideDepositBalance){deferred.resolve(showHideDepositBalance)})}});else deferred.resolve(showHideDepositBalance);return deferred.promise};self.getDepositRefundBalance=function(){var deferred=$q.defer();dataServiceG2.getDepositRefundBalance().then(function(response){var successCode=response.data.returnCodeDesc;if(successCode==="Success"){refundBalance=response.data.data.depositRefundBalance;if(refundBalance&&refundBalance.depositBalance!==undefined&&
refundBalance.depositBalance!=null&&refundBalance.depositBalance>0)showHideDepositBalance="show";else showHideDepositBalance="hide";deferred.resolve(showHideDepositBalance)}});return deferred.promise};self.getCreditCardDetailsForDepositRefund=function(){var deferred=$q.defer();if(creditCards&&creditCards.length>0)deferred.resolve(creditCards);else dataServiceG2.getCreditCardDetailsForDepositRefund().then(function(response){var successCode=response.data.returnCodeDesc;if(successCode==="Success"){creditCards=
response.data.data.depositRefundCardDetails;deferred.resolve(creditCards)}else deferred.reject()});return deferred.promise};self.getRefundBalanceAmount=function(){var deferred=$q.defer();if(refundBalance&&refundBalance.depositBalance!==undefined&&refundBalance.depositBalance!=null&&refundBalance.depositBalance>0)deferred.resolve(refundBalance);else dataServiceG2.getDepositRefundBalance().then(function(response){var successCode=response.data.returnCodeDesc;if(successCode==="Success"){refundBalance=
response.data.data.depositRefundBalance;deferred.resolve(refundBalance)}else deferred.reject()});return deferred.promise};self.getShowHideDepositBalance=function(){return showHideDepositBalance};self.setShowHideDepositBalanceFlag=function(newVal){showHideDepositBalance=newVal};self.renewalFees=function(){var requestParam={};requestParam.GATEWAY_URL_KEY="RENEWAL_FEES";requestParam.cancelCallBackUrl="/logout";requestParam.successCallBackURL="dashboard";dataServiceG2.setPciParam(requestParam,function(response){if(response.returnCode==
1)$window.location.href=response.data.pciURL.trim();else log.error("Error in Gateway")})}}]);
app.service("paymentService",["$location","dataServiceG2","$q",function($location,dataServiceG2,$q){var self=this;self.checkYardBySiteCode=function(yardNumber){var deferred=$q.defer();var requestParam={};requestParam.yardNumber=yardNumber;dataServiceG2.checkYardBySiteCode(requestParam,function(result){if(result.returnCode==1)if(result.data.yardExist)deferred.resolve();else deferred.reject();else deferred.reject()});return deferred.promise};self.showYardNotExistModal=function(){$("#yardNotExistMessage").modal("show")}}]);