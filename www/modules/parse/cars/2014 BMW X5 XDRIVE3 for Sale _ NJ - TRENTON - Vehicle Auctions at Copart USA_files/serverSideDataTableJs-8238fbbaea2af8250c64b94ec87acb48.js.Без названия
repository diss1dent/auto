var Logger=function(params){var formatMessage=function(input){try{if(!input)throw new Error("No input specified.");else{var message=input[0].toString();for(var i=1;i<input.length;i++){var obj=input[i]!==null&&input[i]!==undefined?input[i].toString():"";message=message.replace("{}",obj)}return message}}catch(err){if(window.console)console.log("Logger.formatMessage error: "+err)}return null};var getErrorMessage=function(args){return logName+" ERROR: "+formatMessage(args)};var getWarnMessage=function(args){return logName+
" WARN: "+formatMessage(args)};var getInfoMessage=function(args){return logName+" INFO: "+formatMessage(args)};var getDebugMessage=function(args){return logName+" DEBUG: "+formatMessage(args)};var getConsoleMessage=function(args){return logName+" LOG: "+formatMessage(args)};var getAuditMessage=function(args){return logName+" AUDIT: "+formatMessage(args)};var deriveLevel=function(value){if(typeof value==="string"){value=value.toUpperCase();if(value==="NONE")return Logger.NONE;else if(value==="ERROR")return Logger.ERROR;
else if(value==="WARN")return Logger.WARN;else if(value==="INFO")return Logger.INFO;else if(value==="DEBUG")return Logger.DEBUG}else if(typeof value==="number")if(value===Logger.NONE)return Logger.NONE;else if(value===Logger.ERROR)return Logger.ERROR;else if(value===Logger.WARN)return Logger.WARN;else if(value===Logger.INFO)return Logger.INFO;else if(value===Logger.DEBUG)return Logger.DEBUG;return Logger.DEFAULT};var send=function(level,msg){msg+="; LOCATION: "+window.location.href;msg+="; AGENT: "+
navigator.userAgent;msg+="; CSIZE: "+jQuery.cookie("cCSC")};this.setLevel=function(value){logLevel=deriveLevel(value)};this.getLevel=function(){return logLevel};this.getName=function(){return logName};this.error=function(){if(logLevel>=Logger.ERROR&&window.console)console.log(getErrorMessage(arguments))};this.error.server=function(){if(logLevel>=Logger.ERROR){var msg=getErrorMessage(arguments);if(window.console)console.log(msg);send(Logger.ERROR,msg)}};this.warn=function(){if(logLevel>=Logger.WARN&&
window.console)console.log(getWarnMessage(arguments))};this.warn.server=function(){if(logLevel>=Logger.WARN){var msg=getWarnMessage(arguments);if(window.console)console.log(msg);send(Logger.WARN,msg)}};this.info=function(){if(logLevel>=Logger.INFO&&window.console)console.log(getInfoMessage(arguments))};this.info.server=function(){if(logLevel>=Logger.INFO){var msg=getInfoMessage(arguments);if(window.console)console.log(msg);send(Logger.INFO,msg)}};this.debug=function(){if(logLevel>=Logger.DEBUG&&window.console)console.log(getDebugMessage(arguments))};
this.debug.server=function(){if(logLevel>=Logger.DEBUG){var msg=getDebugMessage(arguments);if(window.console)console.log(msg);send(Logger.DEBUG,msg)}};this.console=function(){if(logLevel>Logger.NONE&&window.console)console.log(getConsoleMessage(arguments))};this.console.server=function(){if(logLevel>Logger.NONE){var msg=getConsoleMessage(arguments);if(window.console)console.log(msg);send(Logger.INFO,msg)}};this.server=function(){if(logLevel>Logger.NONE)send(Logger.INFO,getConsoleMessage(arguments))};
this.audit=function(){if(logLevel>Logger.NONE&&jQuery.cookie("jsAuditLogs"))send(Logger.INFO,getAuditMessage(arguments))};if(!params)params={};var logName=params.name?params.name:"Logger";var logLevel=params.level?deriveLevel(params.level):Logger.DEFAULT;var logNative=params["native"]===false?false:true;if(logNative)window.onerror=function(message,file,line){if(logLevel>=Logger.ERROR){var msg=getErrorMessage(["{}, file\x3d{}, line\x3d{}",message,file,line]);send(Logger.ERROR,msg)}}};Logger.NONE=0;
Logger.ERROR=1;Logger.WARN=2;Logger.INFO=3;Logger.DEBUG=4;Logger.DEFAULT=Logger.WARN;var push=Array.prototype.push,rcheck=/^(?:radio|checkbox)$/i,rplus=/\+/g,rselect=/^(?:option|select-one|select-multiple)$/i,rvalue=/^(?:button|color|date|datetime|datetime-local|email|hidden|month|number|password|range|reset|search|submit|tel|text|textarea|time|url|week)$/i;
function getElements(elements){return elements.map(function(){return this.elements?jQuery.makeArray(this.elements):this}).filter(":input:not(:disabled)").get()}function getElementsByName(elements){var current,elementsByName={};jQuery.each(elements,function(i,element){current=elementsByName[element.name];if(current===undefined)elementsByName[element.name]=[];elementsByName[element.name].push(element)});return elementsByName}
jQuery(document).ready(function(){jQuery.fn.extend({deserialize:function(data,options){var i,length,elements=getElements(this),normalized=[];if(!data||!elements.length)return this;if(jQuery.isArray(data))normalized=data;else if(jQuery.isPlainObject(data)){var key,value;for(key in data)jQuery.isArray(value=data[key])?push.apply(normalized,jQuery.map(value,function(v){return{name:key,value:v}})):push.call(normalized,{name:key,value:value})}else if(typeof data==="string"){var parts;data=data.split("\x26");
for(i=0,length=data.length;i<length;i++){parts=data[i].split("\x3d");push.call(normalized,{name:decodeURIComponent(parts[0].replace(rplus,"%20")),value:decodeURIComponent(parts[1].replace(rplus,"%20"))})}}if(!(length=normalized.length))return this;var current,element,j,len,name,property,type,value,elementsForName,k,nameIndex,optionsAndInputs,change=jQuery.noop,complete=jQuery.noop,names={};options=options||{};elements=getElementsByName(elements);if(jQuery.isFunction(options))complete=options;else{change=
jQuery.isFunction(options.change)?options.change:change;complete=jQuery.isFunction(options.complete)?options.complete:complete}for(i=0;i<length;i++){current=normalized[i];name=current.name;value=current.value;elementsForName=elements[name];if(!elementsForName||elementsForName.length===0)continue;if(names[name]===undefined)names[name]=0;nameIndex=names[name]++;if(elementsForName[nameIndex]){element=elementsForName[nameIndex];type=(element.type||element.nodeName).toLowerCase();if(rvalue.test(type)){change.call(element,
element.value=value);continue}}for(j=0,len=elementsForName.length;j<len;j++){element=elementsForName[j];type=(element.type||element.nodeName).toLowerCase();property=null;if(rcheck.test(type))property="checked";else if(rselect.test(type))property="selected";if(property){optionsAndInputs=[];if(element.options)for(k=0;k<element.options.length;k++)optionsAndInputs.push(element.options[k]);else optionsAndInputs.push(element);for(k=0;k<optionsAndInputs.length;k++){current=optionsAndInputs[k];if(current.value==
value)change.call(current,(current[property]=true)&&value)}}}}complete.call(this);return this}})});"use strict";
app.directive("serverSideDatatable",["$http","$rootScope","dateFilter","ServerSideDataTable","$compile","alphanumericFilter","dataServiceG2","$interpolate","$timeout","cmsContentService","userService","localStorageService","$location","$anchorScroll","geocodingService","metaDataService",function($http,$rootScope,dateFilter,ServerSideDataTable,$compile,alphanumericFilter,dataServiceG2,$interpolate,$timeout,cmsContentService,userService,localStorageService,$location,$anchorScroll,geocodingService,metaDataService){return{restrict:"AE",
transclude:false,controller:function($scope,$element,$attrs){var tableId="#"+$attrs.serverSideDatatable;var self=$scope;var filterChanged=false;if(!self.dataTableOptions)return;self.tableId=tableId;self.appliedFilters=[];var datatable=null;self.multiBidConfirmed=false;self.preBidForms=[];self.locale=$scope.$parent.locale;self.siteCatalystCalled=false;self.compileDOM=function($el,scope){$compile($el)(scope);self.$digest()};var compileAndNoApply=function($el,scope){$compile($el)(scope)};self.dataTableOptions.tempScope=
self.tempScope;var tableData={};var table=new ServerSideDataTable(tableId,self.dataTableOptions,function(table){tableData=table;self.query=table.queryToSave;self.watchListOnly=table.watchListOnly;if(!self.dataTableOptions.showAll){self.tempScope.$destroy();self.tempScope=self.$new()}self.filters=table.filters;self.filterQueryArr=table.filterQueryArr;self.appliedFilters=table.appliedFilters;self.excludedFacet=table.excludedFacet;self.sortApplied=table.sortApplied;self.totalRecords=table.totalRecords;
self.spellCheckList=table.spellCheckList;self.metadata=table.metadata;self.preBidForms=[];var $dest=jQuery(tableId).find("tbody");self.compileDOM($dest,self.tempScope);$(window).trigger("scrollToPoint");$(window).trigger("resize");doSaveOperation();if(!self.siteCatalystCalled){lm.Omniture.doTagSearchInventory(userService.userConfig.buyerNumber,self.query,self.totalRecords,self.zipcode);self.siteCatalystCalled=true}$timeout(function(){self.loadingSearchResults=false;if(jQuery(self.tableId+"_paginate").find(jQuery("ul")).find(jQuery("li")).size()<=
3)jQuery(".pagination").hide();jQuery(".icon-tooltip").each(function(){var e=jQuery(this);addEventListenersForHighlightIcons(e)});self.clearAllCheckBoxes();var fontSize=localStorageService.cookie.get("datatable-font-size");if(fontSize){var table=jQuery("#serverSideDataTable").DataTable();jQuery(".dataTable").css("font-size",fontSize+"px");jQuery("#serverSideDataTable").css("display","table");table.responsive.recalc()}var currentUrl=$location.url();var symbol=currentUrl.indexOf("/?")==-1?"?":"\x26";
var pageIsPresented=currentUrl.indexOf("page\x3d")!=-1;jQuery(".paginate_button").each(function(){jQuery(this).find("a").each(function(){var text=jQuery(this).first().html();if(!_.isNaN(text-0)){var href=generateUrlForPage(currentUrl,text,symbol,pageIsPresented);jQuery(this).attr("href",href)}});jQuery(this).click(function(){self.scrollTop=true})});if(self.scrollTop)$timeout(function(){console.log("pagechanged");var id=$location.hash();$location.hash("top");$anchorScroll();$location.hash(id);self.scrollTop=
false},0);if(self.viewedRowIndex||self.viewedRowIndex==0){jQuery(self.tableId+" tbody tr").eq(self.viewedRowIndex).addClass("bold");self.viewedRowIndex=null}if(filterChanged){var searchObj=self.getSearchObject();$location.search("searchCriteria",JSON.stringify(searchObj));filterChanged=false}handlePagination(currentUrl,symbol,pageIsPresented)},0)},self.getHeaderColumns);datatable=table.init();function handlePagination(url,symbol,pageIsPresented){if(self.metadata.totalElements>0){var lastPageIndex=
Math.floor((self.metadata.totalElements-1)/self.metadata.size);if(self.metadata.start<self.metadata.totalElements){$location.search("page",self.metadata.page+1);var prev=self.metadata.page>0?generateUrlForPage(url,self.metadata.page,symbol,pageIsPresented):null;var next=self.metadata.page<lastPageIndex?generateUrlForPage(url,self.metadata.page+2,symbol,pageIsPresented):null;metaDataService.setPreviousPage(prev);metaDataService.setNextPage(next)}else $(self.tableId).DataTable().page(lastPageIndex).draw(false)}}
function generateUrlForPage(url,page,symbol,pageIsPresented){return pageIsPresented?url.replace(/page=[0-9]*/,"page\x3d"+page):url+symbol+"page\x3d"+page}function doSaveOperation(){datatable.api().state.save()}var yearColumnRegularView=true;datatable.api().on("responsive-display",function(e,datatable,row){self.compileDOM($(datatable.rows(row.index()).nodes()).next(),self.tempScope);if(!yearColumnRegularView){var responsiveChildRow=row.child();var elem=jQuery(responsiveChildRow).find(".icon-tooltip");
addEventListenersForHighlightIcons(elem)}});datatable.api().on("responsive-resize",function(e,datatable,columns){var yearColumnIndex=datatable.column("[data-fieldid\x3d'lotYear']").index();yearColumnRegularView=columns[yearColumnIndex]});function addEventListenersForHighlightIcons(e){e.click(function(){var parentFragmentId="Content/US/EN/_LotIcons/Lot-Icon-List.html";var fragmentId=e.attr("fragment-id");var promise=cmsContentService.setParentFragment(parentFragmentId);promise.then(function(){var fragmentCMSContent=
cmsContentService.getFragmentContent(parentFragmentId);fragmentCMSContent=jQuery(fragmentCMSContent).filter("#"+fragmentId);var isMobile=window.matchMedia("only screen and (max-width: 760px)");var placement;if(isMobile.matches)placement="bottom";else placement="auto right";e.popover({content:fragmentCMSContent,html:true,placement:placement}).popover("toggle")})});e.mouseleave(function(){e.popover("hide")})}datatable.api().on("length.dt",function(e,settings,len){localStorageService.cookie.set("searchResultsPageLength",
len,365)});jQuery(tableId).on("column-visibility.dt",function(e,settings,column,state){var $dest=jQuery(tableId).find("tbody");compileAndNoApply($dest,self.tempScope)});datatable.on("stateSaveParams.dt",function(e,settings,data){data.appliedFilters=self.appliedFilters;data.filters=self.filterQueryArr;data.excludedFacet=self.excludedFacet;data.query=self.dataTableOptions.query;data.freeFormSearch=self.dataTableOptions.freeFormSearch;data.scopeStore={};data.scopeStore.showImages=self.showImages;data.watchListOnly=
self.watchListOnly;data.scopeStore.zipcode=self.zipcode;data.scopeStore.showMultiBidCheckbox=self.showMultiBidCheckbox;if(settings.externalSort){data.sortOrder=tableData.sortOrder;data.externalSort=settings.externalSort}});self.zipChange=function(zip){if(_.isEmpty(zip))self.sortByZip(zip)};self.sortBy=function(header){if(header){datatable.api().order([header.index,header.order]).draw();header.order=header.order=="asc"?"desc":"asc"}};self.sortByZip=function(zip){geocodingService.getCoordinatesForZip(zip,
function(retData){var zipObject={};_.defaults(zipObject,{latitude:"*",longitude:"*",miles:9999});zipObject.latitude=retData.latitude;zipObject.longitude=retData.longitude;zipObject.zip=zip;var paramObj={};paramObj.sfield="yard_location";paramObj.pt=encodeURIComponent(zipObject.latitude+","+zipObject.longitude);table.sortByZip("geodist()","asc",zipObject,paramObj)})};self.placeBids=function(){self.multiBids=[];self.multiBidConfirmed=false;var allAreValid=true;_.each(self.preBidForms,function(item){item.result=
null;if(item.isDirty())if(item.isValid())self.multiBids.push(item);else allAreValid=false});if(self.multiBids.length>0&&allAreValid)$("#multilotsubmitModal").modal("show")};self.clearBids=function(){_.each(self.preBidForms,function(item){if(item.isDirty())item.clear()})};self.confirmMultiBid=function(){var newList=[];_.each(self.multiBids,function(item){var bidItem=item.getBidItem();newList.push(bidItem)});if(userService.isInActive()){_.each(self.multiBids,function(item){item.result=self.locale.messages["lotdetail.error.code.buyer.inactive"]});
self.multiBidConfirmed=true}else dataServiceG2.multilotbid(newList,{onSuccess:function(data){if(data.returnCode==1){_.each(self.multiBids,function(item){if(_.isNull(data.data.result.lots[item.lotNum]))item.result="Success";else{var lotReturnCode=data.data.result.lots[item.lotNum];if(!_.isUndefined(lotReturnCode))item.result=self.locale.getMessage("lotdetail.error.code."+lotReturnCode.errorCode.trim(),lotReturnCode.outLowerBid,lotReturnCode.outHigherBid);else item.result=self.locale.getMessage("lotdetail.label.success")}});
self.multiBidConfirmed=true}},onFailure:function(data){console.error("Error during multi-lot bid");console.error(data)}})};self.closeMultiBidModal=function(){table.redraw()};self.setWatchListOnly=function(){self.watchListOnly=!self.watchListOnly;table.setWatchListOnly(self.watchListOnly);table.applyFilter()};self.applyFilter=function(filter,$event){self.saved=false;filterChanged=true;table.applyFilter(filter,$event,this)};self.removeFilter=function(id){self.saved=false;filterChanged=true;table.removeFilter(id)};
self.isFilterApplied=function(id){return!_.isUndefined(_.find(self.appliedFilters,function(item){return item.id==alphanumericFilter(id)}))};self.clearSectionFilters=function(filter){var sectionFilters=_.filter(self.appliedFilters,function(item){return item.quickPickCode==filter.quickPickCode});_.each(sectionFilters,function(item){removeFilter(item.id)});table.applyFilter()};self.clearAllFilters=function(){var appliedFilters=_.filter(self.appliedFilters,function(item){return item});_.each(appliedFilters,
function(item){removeFilter(item.id)});self.watchListOnly=false;table.setWatchListOnly(false);table.applyFilter()};var removeFilter=function(id){self.saved=false;jQuery("#"+id).prop("checked",false);var index=_.findIndex(self.appliedFilters,function(item){return item.id==id});self.appliedFilters.splice(index,1)}}}}]);
app.factory("ServerSideDataTable",["alphanumericFilter","$interval","config","dataServiceG2","$rootScope","userService","$compile","HttpPendingRequestsService","localStorageService","copartUtils","auctionsCalendarService","dataTableConfig","$interpolate",function(alphanumericFilter,$interval,config,dataServiceG2,$rootScope,userService,$compile,HttpPendingRequestsService,localStorageService,copartUtils,auctionsCalendarService,dataTableConfig,$interpolate){var self=this;var log=new Logger({name:"ServerSideDataTable",
level:config.logLevel});var lastFilterRemoved={};var vehicleFinderFormName="vehicle-finder-form";var SALE_DATE_COL="auction_date_utc";var SALE_DATE_TYPE="auction_date_type";var DOC_TYPE="sale_title_type";var TITLE_STATE="title_state";var LOCATION_COL="yard_name";self.table=null;self.getHeaderColumns=function(){log.error("Please override getHeaderColumns()")};self.id=null;self.filters=[];self.nullIncludeTags=[];self.appliedFilters=[];self.excludedFacet={};self.sortApplied="";self.spellCheckList=[];
self.oneTimeStore={};self.totalRecords="";self.externalSort=false;self.watchListOnly=false;self.queryToSave="*";self.log=new Logger({name:"ServerSide Datatable",level:"debug"});self.callback=function(){log.error("Please override callback()")};function ServerSideDataTable(elementId,dataTableOptions,callback,getHeaderColumns){self.excludedFacet={};self.externalSort=false;self.watchListOnly=false;self.metadata={};self.id=null;self.filters=[];self.appliedFilters=[];self.nullIncludeTags=[];self.spellCheckList=
[];self.sortApplied="";self.id=elementId;self.dataTableOptions=dataTableOptions?dataTableOptions:"{}";self.oneTimeStore={};self.locale=dataTableOptions.tempScope.$parent.locale;if(callback)self.callback=callback;if(getHeaderColumns)self.getHeaderColumns=getHeaderColumns}var compileAndNoApply=function($el,scope){$compile($el)(scope)};function checkIfFreeFormSearch(searchValue){self.fromFreeTextSearch=searchValue!=null&&searchValue.length>0}function getFilterList(){var result={};self.filterQueryArr=
{};self.excludedFacet={};if(self.dataTableOptions.searchCriteria&&!_.isEmpty(self.dataTableOptions.searchCriteria.MISC)){self.filterQueryArr.MISC=self.dataTableOptions.searchCriteria.MISC;var tempCriteria={};if(_.isArray(self.dataTableOptions.searchCriteria.MISC))tempCriteria.MISC=self.dataTableOptions.searchCriteria.MISC.join(",");result=_.extend(result,tempCriteria)}for(var i=0;i<self.appliedFilters.length;i++){var item=self.appliedFilters[i];result[item.quickPickCode]=_.isEmpty(result[item.quickPickCode])?
item.query:result[item.quickPickCode]+","+item.query;if(_.isEmpty(self.filterQueryArr[item.quickPickCode]))self.filterQueryArr[item.quickPickCode]=[item.query];else self.filterQueryArr[item.quickPickCode].push(item.query);if(item.includeTag&&!_.isEmpty(item.includeTag.trim()))self.excludedFacet[item.quickPickCode]=item.includeTag}return result}ServerSideDataTable.prototype.initGotoPageButton=function(){initGotoPageClick();jQuery("#btnGotoPageServerSide").click(function(){var strGotoPage=trimWS(jQuery("#gotopage").val());
var varInvalidPageNumber="Page number entered is invalid.";var integerFilter=/[^0-9]/;if(integerFilter.test(strGotoPage)||strGotoPage.length==0)showUserAlertMsg(varInvalidPageNumber);else{var oTable=jQuery("#serverSideDataTable").DataTable();var oTableInfo=oTable.page.info();var intNumberOfPages=oTableInfo.pages;var intGotoPage=parseInt(strGotoPage);if(intGotoPage>0&&intGotoPage<=intNumberOfPages){var oTablePages=jQuery("#serverSideDataTable").dataTable();oTablePages.fnPageChange(intGotoPage-1);jQuery("#gotopage").val("")}else{showUserAlertMsg(varInvalidPageNumber);
jQuery("#gotopage").focus()}}})};ServerSideDataTable.prototype.sortByZip=function(field,order,zipObject,params){self.externalSort=true;self.sortOrder={};self.sortOrder.field=field;self.sortOrder.order=order;self.sortOrder.rawParams=params;if(self.dataTableOptions.searchCriteria&&self.dataTableOptions.searchCriteria.sortByZip&&self.dataTableOptions.searchCriteria.MISC){var previousForm=localStorageService.get(vehicleFinderFormName);previousForm.zip=zipObject.zip;localStorageService.set(vehicleFinderFormName,
previousForm);self.dataTableOptions.searchCriteria.MISC=_.map(self.dataTableOptions.searchCriteria.MISC,function(item){if(item.indexOf("geofilt")!=-1){zipObject.miles=self.dataTableOptions.searchCriteria.milesAway;item=$interpolate("{!geofilt pt\x3d{{latitude}},{{longitude}} sfield\x3dyard_location d\x3d{{miles}}}")(zipObject);item=encodeURIComponent(item)}return item})}jQuery(self.id).dataTable().fnExternalSort()};ServerSideDataTable.prototype.applySort=function(field,order,tempSortFilter,params){self.externalSort=
true;self.sortOrder={};self.sortOrder.field=field;self.sortOrder.order=order;self.sortOrder.rawParams=params;jQuery(self.id).dataTable().fnExternalSort()};ServerSideDataTable.prototype.setWatchListOnly=function(watchListOnly){if(watchListOnly==true)self.watchListOnly=watchListOnly;else self.watchListOnly=false};ServerSideDataTable.prototype.applyFilter=function(filter,$event,element){if(!_.isEmpty(filter)&&!_.isEmpty($event)&&!_.isEmpty(element)){lastFilterRemoved={quickPickCode:$event.target.name,
searchText:filter.searchText};if($event.target.checked){var item={};item.id=$event.target.id;item.name=element.item.displayName;item.quickPickCode=filter.quickPickCode;item.query=element.item.query;item.includeTag=filter.includeTag;self.appliedFilters.push(item);jQuery(self.id).dataTable().fnExternalDrawFirstPage()}else this.removeFilter($event.target.id)}else jQuery(self.id).dataTable().fnExternalDrawFirstPage()};ServerSideDataTable.prototype.redraw=function(){jQuery(self.id).dataTable().fnStandingRedraw()};
ServerSideDataTable.prototype.removeFilter=function(id){jQuery("#"+id).prop("checked",false);var index=_.findIndex(self.appliedFilters,function(item){return item.id==id});self.appliedFilters.splice(index,1);this.applyFilter("")};function isTheLastFilterApplied(quickPickCode){try{if(lastFilterRemoved.quickPickCode==quickPickCode)return true;else false;return false}catch(e){console.log(e);return false}}function getLastFilterSearchText(){try{return lastFilterRemoved.searchText?lastFilterRemoved.searchText:
""}catch(e){console.log(e);return""}}function setSortArray(sortInfoArr,data){_.each(sortInfoArr,function(sortInfo){var index=sortInfo[0];var header=$(jQuery(self.id).DataTable().column(index).header());var direction=sortInfo[1];var sortBy=header.attr("data-sort-id");var secSortBy=header.attr("data-secondary-sort-id");var sortType=header.attr("data-sort-type");if(sortInfoArr.length==1)if(sortBy==SALE_DATE_COL){var invDirection=direction=="asc"?"desc":"asc";data.sort.push(SALE_DATE_TYPE+" "+invDirection);
data.sort.push(secSortBy+" "+direction)}else if(sortBy==DOC_TYPE){data.sort.push(DOC_TYPE+" "+direction);data.sort.push(TITLE_STATE+" "+direction);data.sort.push(secSortBy+" asc")}else if(sortBy==LOCATION_COL){data.sort.push(sortBy+" "+direction);data.sort.push(secSortBy+" "+direction)}else{data.sort.push(sortBy+" "+direction);data.sort.push(secSortBy+" asc")}else data.sort.push(sortBy+" "+direction);if(sortType=="default"){data.defaultSort=true;if(self.dataTableOptions.searchCriteria&&self.dataTableOptions.searchCriteria.sortByZip)data.sort=
[]}})}ServerSideDataTable.prototype.init=function(){if(self.id==null){log.error("ServerSideDataTable not constructed");return null}var dataTableOptions=self.dataTableOptions;var dataDownloaded=false;self.savedSearchAppliedStep=0;var callback=self.callback;self.table=null;var config=dataTableConfig.getConfig();if(!_.isEmpty(config.columnDef))dataTableOptions.columnDefs.push(config.columnDef);self.table=jQuery(self.id).dataTable({"bProcessing":true,"searchDelay":1E3,"responsive":{details:{type:"column",
target:-1,renderer:function(api,rowIdx,columns){var data=$.map(columns,function(col,i){return col.hidden?'\x3cli data-dt-row\x3d"'+col.rowIndex+'" data-dt-column\x3d"'+col.columnIndex+'"\x3e'+'\x3cspan\x3e\x3cspan class\x3d"bold" data-uname\x3d"saleslistRegion"\x3e'+col.title+": "+'\x3c/span\x3e\x3cspan class\x3d"dtr-data"\x3e'+col.data+"\x3c/span\x3e\x3c/span\x3e"+"\x3c/li\x3e":""}).join("");return data?$("\x3cul/\x3e").append(data):false}}},autoWidth:false,"jQueryUI":dataTableOptions.jQueryUI?dataTableOptions.jQueryUI:
false,pagingType:config.pagingType,"order":dataTableOptions.initOrder?dataTableOptions.initOrder:[],"bServerSide":true,"bStateSave":true,"stateLoadParams":function(oSettings,oData){if(dataTableOptions.stateSave){self.oneTimeStore.appliedFilters=oData.appliedFilters;self.oneTimeStore.filters={};angular.forEach(oData.filters,function(value,key){if(_.isArray(value))this[key]=value.join(",");else this[key]=value},self.oneTimeStore.filters);self.oneTimeStore.query=oData.query;if(oData.externalSort){self.externalSort=
oData.externalSort;$(self.id).dataTable().fnSettings().externalSort=true;self.sortOrder=oData.sortOrder}self.oneTimeStore.freeFormSearch=oData.freeFormSearch;self.oneTimeStore.excludedFacet=oData.excludedFacet;self.watchListOnly=oData.watchListOnly;$rootScope.$emit("state-restore",oData.scopeStore);return true}else return false},"columnDefs":dataTableOptions.columnDefs,"iDisplayLength":dataTableOptions.pageLength?dataTableOptions.pageLength:"10","lengthMenu":dataTableOptions.lengthMenu?dataTableOptions.lengthMenu:
[[10,25,50,100],[10,25,50,100]],"iDisplayStart":dataTableOptions.iDisplayStart?dataTableOptions.iDisplayStart:0,"language":{"emptyTable":"\x3cstrong\x3eTips for improving your search \x3c/strong\x3e\x3cbr/\x3e"+"\x3clabel\x3e"+self.locale.getMessage("app.label.search.emptyTable")+"\x3c/label\x3e"+"\x3ca check-access-by-role\x3d'!COUNTERMAN' data-block-access-by-preference pref-code\x3d'footerLinks' access-value\x3d'veh_alrt' href\x3d'./vehicleAlerts'\x3eClick here to sign up for free Vehicle Alerts!\x3c/a\x3e",
"info":"Showing _START_ to _END_ of _TOTAL_ results","processing":"\x3cimg src\x3d'/images/icons/loader.gif'style\x3d'z-index:100000;'\x3e","lengthMenu":"Show _MENU_ results","searchPlaceholder":"Search this list"},"ajax":{"url":dataTableOptions.url,"dataSrc":function(json){if(!_.isUndefined(json.data.results)){json["recordsTotal"]=json.data.results.totalElements;json["recordsFiltered"]=json.data.results.totalElements;self.spellCheckList=json.data.results.spellCheckList;var info=$(self.id).DataTable().page.info();
self.metadata.page=info.page;self.metadata.size=info.length;self.metadata.start=info.start;self.metadata.totalElements=json["recordsTotal"];if(json["recordsTotal"]<info.length)self.metadata.size=json["recordsTotal"];var results=json.data.results;if(results.totalElements==0&&!self.watchListOnly&&!dataTableOptions.isSubSearch)$rootScope.$emit("no-records",self.spellCheckList);if(dataTableOptions.isSubSearch)dataTableOptions.isSubSearch=false;json["data"]=results.content;if(userService.isAnonymous())auctionsCalendarService.getLotAuctionStatus(results.content).then(function(lots){$rootScope.$emit("got-current-bid-data",
lots)});else{var lots=_.pluck(results.content,"lotNumberStr");dataServiceG2.updatedBidInfo({lots:lots},{onSuccess:function(data){$rootScope.$emit("got-current-bid-data",data)},onFailure:function(data){console.error("Error fetching current bid data");console.error(data)}})}self.filters=[];if(self.filters.length==0)for(var i=0;i<results.facetFields.length;i++){var facet={};facet.name=results.facetFields[i].displayName;facet.includeTag=results.facetFields[i].includeTag;facet.quickPickCode=results.facetFields[i].quickPickCode;
facet.items=copartUtils.clubFacets(results.facetFields[i].facetCounts,facet.quickPickCode);if(isTheLastFilterApplied(facet.quickPickCode)){facet.limit=facet.items.length;facet.searchText=getLastFilterSearchText()}else facet.limit=10;if(_.isUndefined(facet.includeTag)||_.isNull(facet.includeTag)||_.isEmpty(facet.includeTag.trim()))if(_.isEmpty(self.nullIncludeTags))self.nullIncludeTags.push(facet.quickPickCode);facet.facetField=results.facetFields[i].facetField;self.filters.push(facet)}if(dataTableOptions.fromSavedSearch&&
!_.isUndefined(dataTableOptions.saveSearchCriteria.data)&&self.savedSearchAppliedStep==1){var keys=_.keys(dataTableOptions.saveSearchCriteria.data.filter);var tempFilterObject={};angular.extend(tempFilterObject,dataTableOptions.saveSearchCriteria.data.filter);self.appliedFilters=[];_.each(keys,function(key){var category=_.find(self.filters,function(item){return item.quickPickCode==key});if(!_.isUndefined(category))_.each(category.items,function(facet){if(_.indexOf(tempFilterObject[key],facet.query)!=
-1){var item={};item.id=alphanumericFilter(facet.query);item.name=facet.displayName;item.quickPickCode=key;item.query=facet.query;self.appliedFilters.push(item)}})});self.savedSearchAppliedStep++}return json.data}else return{recordsTotal:0,recordsFiltered:0}},"type":"POST","data":function(data){var stateStage=localStorageService.get("stateStage");var queryArr=[];data.sort=[];var searchValue=data.search.value;var info=$(self.id).DataTable().page.info();queryArr.push(dataTableOptions.query);if(searchValue!=
null&&searchValue.length>0)queryArr.push(searchValue);checkIfFreeFormSearch(searchValue);var sortInfoArr=$(self.id).dataTable().fnSettings().aaSorting;var externalSort=$(self.id).dataTable().fnSettings().externalSort&&!(sortInfoArr.length>0);if(externalSort==true){data.sort.push(self.sortOrder.field+" "+self.sortOrder.order);data.sort=data.sort.join(",");if(self.sortOrder.rawParams)data.rawParams=self.sortOrder.rawParams}else if(sortInfoArr.length>0){$(self.id).dataTable().fnSettings().externalSort=
false;setSortArray(sortInfoArr,data);data.sort=data.sort.join(",");self.sortApplied=data.sort}if(dataTableOptions.fromSavedSearch&&!_.isEmpty(dataTableOptions.saveSearchCriteria.data)&&self.savedSearchAppliedStep==0)try{var keys=_.keys(dataTableOptions.saveSearchCriteria.data.filter);self.appliedFilters=[];var filterResult={};_.each(keys,function(key){var sectionFilters=dataTableOptions.saveSearchCriteria.data.filter[key];filterResult[key]=sectionFilters.join(",")});if(dataTableOptions.saveSearchCriteria.data.filter.MISC){self.dataTableOptions.searchCriteria=
{};self.dataTableOptions.searchCriteria.MISC=dataTableOptions.saveSearchCriteria.data.filter.MISC}data.filter=filterResult;data.query=dataTableOptions.saveSearchCriteria.data.query.join(",");dataTableOptions.query=data.query;self.filterQueryArr=data.filter;data.sort=dataTableOptions.saveSearchCriteria.data.sort.join(",");self.watchListOnly=dataTableOptions.saveSearchCriteria.data.watchListOnly;dataTableOptions.freeFormSearch=dataTableOptions.saveSearchCriteria.data.freeFormSearch;self.savedSearchAppliedStep++;
localStorageService.set("stateStage","0")}catch(e){console.log(dataTableOptions.saveSearchCriteria.data);console.error(e)}else if(stateStage=="1"){data.filter=self.oneTimeStore.filters;self.filterQueryArr=data.filter;data.query=self.oneTimeStore.query;self.appliedFilters=self.oneTimeStore.appliedFilters;dataTableOptions.freeFormSearch=self.oneTimeStore.freeFormSearch;self.excludedFacet=self.oneTimeStore.excludedFacet;self.oneTimeStore={};localStorageService.set("stateStage","0")}else{data.filter=
getFilterList();data.query=queryArr.join(",")}self.queryToSave=data.query;data.watchListOnly=self.watchListOnly;data.freeFormSearch=dataTableOptions.freeFormSearch;data.page=info.page;data.size=info.length;self.metadata.page=data.page;self.metadata.size=data.size;if(info.recordsTotal<data.size)self.metadata.size=info.recordsTotal;data.includeTagByField=self.excludedFacet},"error":function(jqXHR,status,errorThrown){}},"dom":config.dom,"fnInitComplete":function(oSettings,json){var dTable=jQuery(self.id).DataTable();
$(".dataTables_filter input").unbind().bind("input",_.throttle(function(e){dataTableOptions.isSubSearch=true;console.log(this.value);if(this.value==""||this.value.length>=3||this.value.length==0){dTable.search(this.value);dTable.draw();return}if(this.value.length<3)return},1E3)).bind("keydown",function(e){dataTableOptions.isSubSearch=true;if(e.keyCode==13)dTable.search(this.value).draw()});if(dataTableOptions.afterInit)dataTableOptions.afterInit(dTable)},"fnDrawCallback":function(o){var dTable=jQuery(self.id).DataTable();
self.totalRecords=dTable.page.info().recordsTotal;callback(self)},"aoColumns":self.getHeaderColumns()});return self.table};return ServerSideDataTable}]);